<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 R and the Tidyverse | Course Notes - IDSC 4210</title>
  <meta name="description" content="5 R and the Tidyverse | Course Notes - IDSC 4210" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 R and the Tidyverse | Course Notes - IDSC 4210" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 R and the Tidyverse | Course Notes - IDSC 4210" />
  
  
  

<meta name="author" content="Prepared by Jeff Clement" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="design-fundamentals.html"/>
<link rel="next" href="intro-to-ggplot.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Interactive Data Visualization for Business Analytics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#about-the-course"><i class="fa fa-check"></i><b>1.1</b> About the Course</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#objectives"><i class="fa fa-check"></i><b>1.1.1</b> Objectives</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#design-vs.-programming"><i class="fa fa-check"></i><b>1.2</b> Design vs. Programming</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#recommended-books"><i class="fa fa-check"></i><b>1.3</b> Recommended Books</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html"><i class="fa fa-check"></i><b>2</b> Installing R and Loading Datasets</a>
<ul>
<li class="chapter" data-level="2.1" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#installing-r-rstudio-and-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Installing R, RStudio, and Tidyverse</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#step-1-install-r"><i class="fa fa-check"></i><b>2.1.1</b> Step 1: Install R</a></li>
<li class="chapter" data-level="2.1.2" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#step-2-install-rstudio"><i class="fa fa-check"></i><b>2.1.2</b> Step 2: Install RStudio</a></li>
<li class="chapter" data-level="2.1.3" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#step-2-install-the-tidyverse-and-ggplot-visualization-package"><i class="fa fa-check"></i><b>2.1.3</b> Step 2: Install the tidyverse (and ggPlot Visualization Package)</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#load-the-dataset-for-this-course"><i class="fa fa-check"></i><b>2.2</b> Load the Dataset for This Course</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#download-the-dataset"><i class="fa fa-check"></i><b>2.2.1</b> Download the Dataset</a></li>
<li class="chapter" data-level="2.2.2" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#set-working-directory"><i class="fa fa-check"></i><b>2.2.2</b> Set Working Directory</a></li>
<li class="chapter" data-level="2.2.3" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#load-dataset-into-r"><i class="fa fa-check"></i><b>2.2.3</b> Load Dataset into R</a></li>
<li class="chapter" data-level="2.2.4" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#examine-the-booking-dataset"><i class="fa fa-check"></i><b>2.2.4</b> Examine the Booking Dataset</a></li>
<li class="chapter" data-level="2.2.5" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#observations-variables-and-values"><i class="fa fa-check"></i><b>2.2.5</b> Observations, Variables and Values</a></li>
<li class="chapter" data-level="2.2.6" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#initial-exploration"><i class="fa fa-check"></i><b>2.2.6</b> Initial Exploration</a></li>
<li class="chapter" data-level="2.2.7" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#missing-data"><i class="fa fa-check"></i><b>2.2.7</b> Missing Data</a></li>
<li class="chapter" data-level="2.2.8" data-path="installing-r-and-loading-datasets.html"><a href="installing-r-and-loading-datasets.html#tables-and-counts"><i class="fa fa-check"></i><b>2.2.8</b> Tables and Counts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploring-and-communicating-with-data.html"><a href="exploring-and-communicating-with-data.html"><i class="fa fa-check"></i><b>3</b> Exploring and Communicating with Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exploring-and-communicating-with-data.html"><a href="exploring-and-communicating-with-data.html#the-data-science-cycle"><i class="fa fa-check"></i><b>3.1</b> The Data Science Cycle</a></li>
<li class="chapter" data-level="3.2" data-path="exploring-and-communicating-with-data.html"><a href="exploring-and-communicating-with-data.html#exploratory-vs.-explanatory-data-analysis"><i class="fa fa-check"></i><b>3.2</b> Exploratory vs. Explanatory Data Analysis</a></li>
<li class="chapter" data-level="3.3" data-path="exploring-and-communicating-with-data.html"><a href="exploring-and-communicating-with-data.html#storytelling-with-data"><i class="fa fa-check"></i><b>3.3</b> Storytelling with Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="exploring-and-communicating-with-data.html"><a href="exploring-and-communicating-with-data.html#step-1-focus-attention"><i class="fa fa-check"></i><b>3.3.1</b> Step 1: Focus Attention</a></li>
<li class="chapter" data-level="3.3.2" data-path="exploring-and-communicating-with-data.html"><a href="exploring-and-communicating-with-data.html#step-2-tell-a-story"><i class="fa fa-check"></i><b>3.3.2</b> Step 2: Tell a Story</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="design-fundamentals.html"><a href="design-fundamentals.html"><i class="fa fa-check"></i><b>4</b> Design Fundamentals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="design-fundamentals.html"><a href="design-fundamentals.html#visual-perception-facts"><i class="fa fa-check"></i><b>4.1</b> Visual Perception Facts</a></li>
<li class="chapter" data-level="4.2" data-path="design-fundamentals.html"><a href="design-fundamentals.html#color-theory"><i class="fa fa-check"></i><b>4.2</b> Color Theory</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="design-fundamentals.html"><a href="design-fundamentals.html#color-and-accessibility"><i class="fa fa-check"></i><b>4.2.1</b> Color and Accessibility</a></li>
<li class="chapter" data-level="4.2.2" data-path="design-fundamentals.html"><a href="design-fundamentals.html#consistency"><i class="fa fa-check"></i><b>4.2.2</b> Consistency</a></li>
<li class="chapter" data-level="4.2.3" data-path="design-fundamentals.html"><a href="design-fundamentals.html#red-yellow-green-stoplight-scales"><i class="fa fa-check"></i><b>4.2.3</b> Red-Yellow-Green “Stoplight” Scales</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="design-fundamentals.html"><a href="design-fundamentals.html#preattentive-visual-attributes"><i class="fa fa-check"></i><b>4.3</b> Preattentive Visual Attributes</a></li>
<li class="chapter" data-level="4.4" data-path="design-fundamentals.html"><a href="design-fundamentals.html#tuftes-data-visualization-principles"><i class="fa fa-check"></i><b>4.4</b> Tufte’s Data Visualization Principles</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="design-fundamentals.html"><a href="design-fundamentals.html#chartjunk"><i class="fa fa-check"></i><b>4.4.1</b> Chartjunk</a></li>
<li class="chapter" data-level="4.4.2" data-path="design-fundamentals.html"><a href="design-fundamentals.html#graphical-integrity"><i class="fa fa-check"></i><b>4.4.2</b> Graphical Integrity</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="design-fundamentals.html"><a href="design-fundamentals.html#second-test"><i class="fa fa-check"></i><b>4.5</b> 15 Second Test</a></li>
<li class="chapter" data-level="4.6" data-path="design-fundamentals.html"><a href="design-fundamentals.html#fixing-cluttered-visualizations"><i class="fa fa-check"></i><b>4.6</b> Fixing Cluttered Visualizations</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="design-fundamentals.html"><a href="design-fundamentals.html#facet-to-make-multiple-visualizations"><i class="fa fa-check"></i><b>4.6.1</b> Facet to make Multiple Visualizations</a></li>
<li class="chapter" data-level="4.6.2" data-path="design-fundamentals.html"><a href="design-fundamentals.html#switch-to-a-table"><i class="fa fa-check"></i><b>4.6.2</b> Switch to a Table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html"><i class="fa fa-check"></i><b>5</b> R and the Tidyverse</a>
<ul>
<li class="chapter" data-level="5.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#using-r-and-the-tidyverse"><i class="fa fa-check"></i><b>5.1</b> Using R and the Tidyverse</a></li>
<li class="chapter" data-level="5.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#basic-commands"><i class="fa fa-check"></i><b>5.2</b> Basic Commands</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#comments"><i class="fa fa-check"></i><b>5.2.1</b> Comments</a></li>
<li class="chapter" data-level="5.2.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#storing-objects"><i class="fa fa-check"></i><b>5.2.2</b> Storing objects</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#saving-and-loading-in-data"><i class="fa fa-check"></i><b>5.3</b> Saving and Loading in Data</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#csv-comma-separated-values"><i class="fa fa-check"></i><b>5.3.1</b> .csv (Comma Separated Values)</a></li>
<li class="chapter" data-level="5.3.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#rds-r-data-file"><i class="fa fa-check"></i><b>5.3.2</b> .rds (R Data File)</a></li>
<li class="chapter" data-level="5.3.3" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#long-vs-wide-data"><i class="fa fa-check"></i><b>5.3.3</b> Long vs Wide Data</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#the-pipe-operator"><i class="fa fa-check"></i><b>5.4</b> The Pipe Operator</a></li>
<li class="chapter" data-level="5.5" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#logicals-and-filtering-the-data"><i class="fa fa-check"></i><b>5.5</b> Logicals and Filtering the Data</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#equal-greater-less-than"><i class="fa fa-check"></i><b>5.5.1</b> Equal, Greater, Less Than</a></li>
<li class="chapter" data-level="5.5.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#filter-dataset"><i class="fa fa-check"></i><b>5.5.2</b> Filter dataset</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#creating-new-variables"><i class="fa fa-check"></i><b>5.6</b> Creating New Variables</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#making-dates"><i class="fa fa-check"></i><b>5.6.1</b> Making Dates</a></li>
<li class="chapter" data-level="5.6.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#if_else"><i class="fa fa-check"></i><b>5.6.2</b> if_else</a></li>
<li class="chapter" data-level="5.6.3" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#case_when"><i class="fa fa-check"></i><b>5.6.3</b> case_when</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#grouping-and-summarizing"><i class="fa fa-check"></i><b>5.7</b> Grouping and Summarizing</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#grouping"><i class="fa fa-check"></i><b>5.7.1</b> Grouping</a></li>
<li class="chapter" data-level="5.7.2" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#summarize-outside-ggplot"><i class="fa fa-check"></i><b>5.7.2</b> Summarize Outside ggplot</a></li>
<li class="chapter" data-level="5.7.3" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#inside-ggplot-with-stat_summary"><i class="fa fa-check"></i><b>5.7.3</b> Inside ggplot with stat_summary</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="r-and-the-tidyverse.html"><a href="r-and-the-tidyverse.html#joining-data"><i class="fa fa-check"></i><b>5.8</b> Joining Data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html"><i class="fa fa-check"></i><b>6</b> Intro to ggplot</a>
<ul>
<li class="chapter" data-level="6.1" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#why-ggplot"><i class="fa fa-check"></i><b>6.1</b> Why ggplot?</a></li>
<li class="chapter" data-level="6.2" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#resources"><i class="fa fa-check"></i><b>6.2</b> Resources</a></li>
<li class="chapter" data-level="6.3" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#ggplot2-vs-base-r"><i class="fa fa-check"></i><b>6.3</b> ggplot2 vs Base R</a></li>
<li class="chapter" data-level="6.4" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#grammar-of-graphics"><i class="fa fa-check"></i><b>6.4</b> Grammar of Graphics</a></li>
<li class="chapter" data-level="6.5" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#themes"><i class="fa fa-check"></i><b>6.5</b> Themes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>7</b> Data Types</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-types.html"><a href="data-types.html#categorical-data"><i class="fa fa-check"></i><b>7.1</b> Categorical Data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="data-types.html"><a href="data-types.html#nominal"><i class="fa fa-check"></i><b>7.1.1</b> Nominal</a></li>
<li class="chapter" data-level="7.1.2" data-path="data-types.html"><a href="data-types.html#ordinal"><i class="fa fa-check"></i><b>7.1.2</b> Ordinal</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="data-types.html"><a href="data-types.html#numerical-data"><i class="fa fa-check"></i><b>7.2</b> Numerical Data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="data-types.html"><a href="data-types.html#discrete-vs.-continuous"><i class="fa fa-check"></i><b>7.2.1</b> Discrete vs. Continuous</a></li>
<li class="chapter" data-level="7.2.2" data-path="data-types.html"><a href="data-types.html#interval"><i class="fa fa-check"></i><b>7.2.2</b> Interval</a></li>
<li class="chapter" data-level="7.2.3" data-path="data-types.html"><a href="data-types.html#ratio"><i class="fa fa-check"></i><b>7.2.3</b> Ratio</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="data-types.html"><a href="data-types.html#measurement-error-and-data-limitations"><i class="fa fa-check"></i><b>7.3</b> Measurement Error and Data Limitations</a></li>
<li class="chapter" data-level="7.4" data-path="data-types.html"><a href="data-types.html#tricky-cases"><i class="fa fa-check"></i><b>7.4</b> Tricky Cases</a></li>
<li class="chapter" data-level="7.5" data-path="data-types.html"><a href="data-types.html#calculations-possible-by-data-type"><i class="fa fa-check"></i><b>7.5</b> Calculations Possible by Data Type</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="distribution-analysis.html"><a href="distribution-analysis.html"><i class="fa fa-check"></i><b>8</b> Distribution Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="distribution-analysis.html"><a href="distribution-analysis.html#histogram"><i class="fa fa-check"></i><b>8.1</b> Histograms</a></li>
<li class="chapter" data-level="8.2" data-path="distribution-analysis.html"><a href="distribution-analysis.html#density-plot"><i class="fa fa-check"></i><b>8.2</b> Density Plot</a></li>
<li class="chapter" data-level="8.3" data-path="distribution-analysis.html"><a href="distribution-analysis.html#box-plot"><i class="fa fa-check"></i><b>8.3</b> Box Plot</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="comparing-quantities.html"><a href="comparing-quantities.html"><i class="fa fa-check"></i><b>9</b> Comparing Quantities</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="comparing-quantities.html"><a href="comparing-quantities.html#scatterplot"><i class="fa fa-check"></i><b>9.0.1</b> Scatterplot</a></li>
<li class="chapter" data-level="9.0.2" data-path="comparing-quantities.html"><a href="comparing-quantities.html#bar-chart"><i class="fa fa-check"></i><b>9.0.2</b> Bar Chart</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html"><i class="fa fa-check"></i><b>10</b> Correlation and Regression</a>
<ul>
<li class="chapter" data-level="10.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#correlation"><i class="fa fa-check"></i><b>10.1</b> Correlation</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#correlation-coefficient"><i class="fa fa-check"></i><b>10.1.1</b> Correlation Coefficient</a></li>
<li class="chapter" data-level="10.1.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#correlation-vs-causation"><i class="fa fa-check"></i><b>10.1.2</b> Correlation vs Causation</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#causal-inference"><i class="fa fa-check"></i><b>10.2</b> Causal Inference</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#resources-for-causal-inference"><i class="fa fa-check"></i><b>10.2.1</b> Resources for Causal Inference</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#regression-lines"><i class="fa fa-check"></i><b>10.3</b> Regression Lines</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#linear-regression"><i class="fa fa-check"></i><b>10.3.1</b> Linear Regression</a></li>
<li class="chapter" data-level="10.3.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#loess-smoothing"><i class="fa fa-check"></i><b>10.3.2</b> Loess Smoothing</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#warning-berksons-paradox"><i class="fa fa-check"></i><b>10.4</b> Warning: Berkson’s Paradox</a></li>
<li class="chapter" data-level="10.5" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#advanced-topics-machine-learning"><i class="fa fa-check"></i><b>10.5</b> Advanced Topics: Machine Learning</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#classification-tree"><i class="fa fa-check"></i><b>10.5.1</b> Classification Tree</a></li>
<li class="chapter" data-level="10.5.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#cluster-analysis"><i class="fa fa-check"></i><b>10.5.2</b> Cluster Analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html"><i class="fa fa-check"></i><b>11</b> Line Graphs and Time Series</a>
<ul>
<li class="chapter" data-level="11.1" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#line-graphs"><i class="fa fa-check"></i><b>11.1</b> Line Graphs</a></li>
<li class="chapter" data-level="11.2" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#other-tools-for-time-series"><i class="fa fa-check"></i><b>11.2</b> Other Tools for Time Series</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#scatterplot-1"><i class="fa fa-check"></i><b>11.2.1</b> Scatterplot</a></li>
<li class="chapter" data-level="11.2.2" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#box-plot-1"><i class="fa fa-check"></i><b>11.2.2</b> Box plot</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#seasonality-cycles-and-normalizing-data"><i class="fa fa-check"></i><b>11.3</b> Seasonality, Cycles, and “Normalizing” Data</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#plotting-cyclical-data"><i class="fa fa-check"></i><b>11.3.1</b> Plotting Cyclical Data</a></li>
<li class="chapter" data-level="11.3.2" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#normalization"><i class="fa fa-check"></i><b>11.3.2</b> Normalization</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#variations"><i class="fa fa-check"></i><b>11.4</b> Variations</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#slope-graph"><i class="fa fa-check"></i><b>11.4.1</b> <strong>Slope Graph</strong></a></li>
<li class="chapter" data-level="11.4.2" data-path="line-graphs-and-time-series.html"><a href="line-graphs-and-time-series.html#tufte-style-line-graph"><i class="fa fa-check"></i><b>11.4.2</b> Tufte-Style Line Graph</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="parts-to-whole-analysis.html"><a href="parts-to-whole-analysis.html"><i class="fa fa-check"></i><b>12</b> Parts-To-Whole Analysis</a>
<ul>
<li class="chapter" data-level="12.1" data-path="parts-to-whole-analysis.html"><a href="parts-to-whole-analysis.html#why-no-pie"><i class="fa fa-check"></i><b>12.1</b> Why no pie?</a></li>
<li class="chapter" data-level="12.2" data-path="parts-to-whole-analysis.html"><a href="parts-to-whole-analysis.html#bar-charts"><i class="fa fa-check"></i><b>12.2</b> Bar Charts</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="parts-to-whole-analysis.html"><a href="parts-to-whole-analysis.html#to-stack-or-not-to-stack"><i class="fa fa-check"></i><b>12.2.1</b> To Stack or Not to Stack?</a></li>
<li class="chapter" data-level="12.2.2" data-path="parts-to-whole-analysis.html"><a href="parts-to-whole-analysis.html#waterfall-charts"><i class="fa fa-check"></i><b>12.2.2</b> Waterfall Charts</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="parts-to-whole-analysis.html"><a href="parts-to-whole-analysis.html#area-plot"><i class="fa fa-check"></i><b>12.3</b> Area Plot</a></li>
<li class="chapter" data-level="12.4" data-path="parts-to-whole-analysis.html"><a href="parts-to-whole-analysis.html#mosaic-plots"><i class="fa fa-check"></i><b>12.4</b> Mosaic Plots</a></li>
<li class="chapter" data-level="12.5" data-path="parts-to-whole-analysis.html"><a href="parts-to-whole-analysis.html#tree-map"><i class="fa fa-check"></i><b>12.5</b> Tree Map</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html"><i class="fa fa-check"></i><b>13</b> Multivariate Analysis</a>
<ul>
<li class="chapter" data-level="13.1" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#heatmaps"><i class="fa fa-check"></i><b>13.1</b> Heatmaps</a></li>
<li class="chapter" data-level="13.2" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#parallel-coordinate-plots"><i class="fa fa-check"></i><b>13.2</b> Parallel Coordinate Plots</a></li>
<li class="chapter" data-level="13.3" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#maps-and-geographic-plots"><i class="fa fa-check"></i><b>13.3</b> Maps and Geographic Plots</a></li>
<li class="chapter" data-level="13.4" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#sankey-plots"><i class="fa fa-check"></i><b>13.4</b> Sankey Plots</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html"><i class="fa fa-check"></i><b>14</b> Interactive Dashboards</a>
<ul>
<li class="chapter" data-level="14.1" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#purpose"><i class="fa fa-check"></i><b>14.1</b> Purpose</a></li>
<li class="chapter" data-level="14.2" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#dashboards-defined"><i class="fa fa-check"></i><b>14.2</b> Dashboards Defined</a></li>
<li class="chapter" data-level="14.3" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#common-tools"><i class="fa fa-check"></i><b>14.3</b> Common Tools</a></li>
<li class="chapter" data-level="14.4" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#guidelines-for-dashboards"><i class="fa fa-check"></i><b>14.4</b> Guidelines for Dashboards</a></li>
<li class="chapter" data-level="14.5" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#visual-layout"><i class="fa fa-check"></i><b>14.5</b> Visual Layout</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#f-and-z-scanning-patterns"><i class="fa fa-check"></i><b>14.5.1</b> F and Z Scanning Patterns</a></li>
<li class="chapter" data-level="14.5.2" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#negative-space-or-white-space"><i class="fa fa-check"></i><b>14.5.2</b> Negative Space or White Space</a></li>
<li class="chapter" data-level="14.5.3" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#colors"><i class="fa fa-check"></i><b>14.5.3</b> Colors</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#dashboard-design-process"><i class="fa fa-check"></i><b>14.6</b> Dashboard Design Process</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#define-requirements"><i class="fa fa-check"></i><b>14.6.1</b> Define Requirements</a></li>
<li class="chapter" data-level="14.6.2" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#mockup-dashboard"><i class="fa fa-check"></i><b>14.6.2</b> Mockup Dashboard</a></li>
<li class="chapter" data-level="14.6.3" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#build-dashboard"><i class="fa fa-check"></i><b>14.6.3</b> Build Dashboard</a></li>
<li class="chapter" data-level="14.6.4" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#launch-to-users"><i class="fa fa-check"></i><b>14.6.4</b> Launch to Users</a></li>
<li class="chapter" data-level="14.6.5" data-path="interactive-dashboards.html"><a href="interactive-dashboards.html#evaluate-performance"><i class="fa fa-check"></i><b>14.6.5</b> Evaluate Performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="accessible-design.html"><a href="accessible-design.html"><i class="fa fa-check"></i><b>15</b> Accessible Design</a>
<ul>
<li class="chapter" data-level="15.1" data-path="accessible-design.html"><a href="accessible-design.html#include-a-summary"><i class="fa fa-check"></i><b>15.1</b> Include a Summary</a></li>
<li class="chapter" data-level="15.2" data-path="accessible-design.html"><a href="accessible-design.html#clearly-label-data"><i class="fa fa-check"></i><b>15.2</b> Clearly Label Data</a></li>
<li class="chapter" data-level="15.3" data-path="accessible-design.html"><a href="accessible-design.html#supporting-screen-readers-e.g.-voiceover"><i class="fa fa-check"></i><b>15.3</b> Supporting Screen Readers (e.g. VoiceOver)</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="accessible-design.html"><a href="accessible-design.html#careful-with-interactions"><i class="fa fa-check"></i><b>15.3.1</b> Careful with Interactions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html"><i class="fa fa-check"></i><b>16</b> Bias and Ethics in Data Analysis</a>
<ul>
<li class="chapter" data-level="16.1" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#bias-defined"><i class="fa fa-check"></i><b>16.1</b> Bias Defined</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#mathematical-bias"><i class="fa fa-check"></i><b>16.1.1</b> Mathematical Bias</a></li>
<li class="chapter" data-level="16.1.2" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#bias-more-broadly"><i class="fa fa-check"></i><b>16.1.2</b> Bias more broadly</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#sources-of-bias"><i class="fa fa-check"></i><b>16.2</b> Sources of Bias</a></li>
<li class="chapter" data-level="16.3" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#bias-from-the-real-world"><i class="fa fa-check"></i><b>16.3</b> Bias from the Real World</a></li>
<li class="chapter" data-level="16.4" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#bias-introduced-at-data-collection"><i class="fa fa-check"></i><b>16.4</b> Bias introduced at Data Collection</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#selection-bias"><i class="fa fa-check"></i><b>16.4.1</b> Selection Bias</a></li>
<li class="chapter" data-level="16.4.2" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#measurement-error"><i class="fa fa-check"></i><b>16.4.2</b> Measurement Error</a></li>
<li class="chapter" data-level="16.4.3" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#bias-in-analysis"><i class="fa fa-check"></i><b>16.4.3</b> Bias in Analysis</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="bias-and-ethics-in-data-analysis.html"><a href="bias-and-ethics-in-data-analysis.html#what-to-do"><i class="fa fa-check"></i><b>16.5</b> What to Do</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html"><i class="fa fa-check"></i><b>17</b> Common ggplot Problems</a>
<ul>
<li class="chapter" data-level="17.1" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#reorder-factor-levels-in-a-bar-graph"><i class="fa fa-check"></i><b>17.1</b> Reorder Factor Levels in a Bar Graph</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#reorder-by-a-different-value"><i class="fa fa-check"></i><b>17.1.1</b> Reorder by a different value</a></li>
<li class="chapter" data-level="17.1.2" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#reorder-by-frequency"><i class="fa fa-check"></i><b>17.1.2</b> Reorder by frequency</a></li>
<li class="chapter" data-level="17.1.3" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#only-show-n-levels-other"><i class="fa fa-check"></i><b>17.1.3</b> Only show n levels + “Other”</a></li>
<li class="chapter" data-level="17.1.4" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#manually-relevel"><i class="fa fa-check"></i><b>17.1.4</b> Manually relevel</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#fix-dates"><i class="fa fa-check"></i><b>17.2</b> Fix Dates</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#extract-days-of-the-week-from-a-date"><i class="fa fa-check"></i><b>17.2.1</b> Extract Days of the Week from a Date</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#scaling-axes"><i class="fa fa-check"></i><b>17.3</b> Scaling Axes</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#rescaling-and-rounding-currency"><i class="fa fa-check"></i><b>17.3.1</b> Rescaling and Rounding Currency</a></li>
<li class="chapter" data-level="17.3.2" data-path="common-ggplot-problems.html"><a href="common-ggplot-problems.html#percent-format"><i class="fa fa-check"></i><b>17.3.2</b> Percent Format</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Course Notes - IDSC 4210</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-and-the-tidyverse" class="section level1" number="5">
<h1><span class="header-section-number">5</span> R and the Tidyverse</h1>
<p><img src="IDSC4210CanvasBanner.png" /></p>
<div id="using-r-and-the-tidyverse" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Using R and the Tidyverse</h2>
<p>This course is not a comprehensive introduction to R for Data Science (there are many excellent resources online, as well as great “bootcamps”). But we need to have a basic understanding of how R works and how to use some of the data manipulation (“wrangling”) tools.</p>
</div>
<div id="basic-commands" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Basic Commands</h2>
<div id="comments" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Comments</h3>
<p>Good code has lots of comments. You might think you’ll remember how your code works, but you won’t! Not a year from now! More importantly, your collaborators might not understand it. Putting the hashtag <code>#</code> in front of the text to “comments it out” so that it won’t run.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="r-and-the-tidyverse.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Start your code sections with 3-5 hashtags</span></span>
<span id="cb1-2"><a href="r-and-the-tidyverse.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;Subcomments&quot; only get one hashtag</span></span></code></pre></div>
<p>Organized, well-commented code is a hallmark of a thoughtful professional, but we all fall short sometimes.</p>
</div>
<div id="storing-objects" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Storing objects</h3>
<p>You can either use the “assignment operator” <code>&lt;-</code> or the equals sign <code>=</code> when you want to assign a value/data to a variable. There are very slight differences in how they work (specifically, the order in which they will be parsed) but these are of little practical significance.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="r-and-the-tidyverse.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Demonstrate two ways of assigning values to variables</span></span>
<span id="cb2-2"><a href="r-and-the-tidyverse.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First use assignment operator</span></span>
<span id="cb2-3"><a href="r-and-the-tidyverse.html#cb2-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb2-4"><a href="r-and-the-tidyverse.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="r-and-the-tidyverse.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then use the equal sign</span></span>
<span id="cb4-2"><a href="r-and-the-tidyverse.html#cb4-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb4-3"><a href="r-and-the-tidyverse.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(y)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Stylistically, I recommend the assignment operator, but you may see the equal sign when looking at some help files.</p>
<p>The “double equal sign” <code>==</code> is used to <em>test</em> whether two things are equal (which we’ll talk about later).</p>
</div>
</div>
<div id="saving-and-loading-in-data" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Saving and Loading in Data</h2>
<p>I won’t go into detail here, but there is lots of information available on <a href="https://readr.tidyverse.org/">the <code>readr</code> package</a> which lets you import/export data into/from R. There are also Base R functions (which are a little slower and less intuitive) and <code>data.table</code> functions (which are faster but less intuitive). Personally, I use <code>readr</code>.</p>
<div id="csv-comma-separated-values" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> .csv (Comma Separated Values)</h3>
<p>Data is often stored as text separated by commas. You’ve probably downloaded one of these files before, and if you just double click on it, your computer will probably try to open it with Excel or Numbers. We can read these files into R using the <code>read_csv</code> command from the <code>readr</code> package (included in the <code>tidyverse</code>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="r-and-the-tidyverse.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure you loaded the tidyverse</span></span>
<span id="cb6-2"><a href="r-and-the-tidyverse.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in booking data, note we have to &quot;put&quot; it somewhere</span></span>
<span id="cb6-3"><a href="r-and-the-tidyverse.html#cb6-3" aria-hidden="true" tabindex="-1"></a>booking_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;hotel_bookings.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   hotel = col_character(),
##   arrival_date_month = col_character(),
##   meal = col_character(),
##   country = col_character(),
##   market_segment = col_character(),
##   reserved_room_type = col_character(),
##   assigned_room_type = col_character(),
##   deposit_type = col_character(),
##   agent = col_character(),
##   reservation_status = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<p>If we’ve manipulated the data and want to save it, send it to a colleague, or perhaps analyze it in another program, we might want to save the “new” file back as a <code>.csv</code>.</p>
<p>We can do that with the <code>write_csv</code> command.</p>
</div>
<div id="rds-r-data-file" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> .rds (R Data File)</h3>
<p>Another data format we’ll see in this class is the <code>.rds</code> file. This is R’s native data format. We use the <code>read_rds</code> command. Loading tends to be very fast (much faster than a <code>.csv</code>). These files can also be much smaller than CSV files.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="r-and-the-tidyverse.html#cb9-1" aria-hidden="true" tabindex="-1"></a>PCard <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;SanJosePCardTransactions&quot;</span>)</span></code></pre></div>
<p>If we need to save the file, we do that with the <code>write_rds</code> command.</p>
</div>
<div id="long-vs-wide-data" class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Long vs Wide Data</h3>
<p>In this course, you will be provided with data that has (mostly) been scrubbed for you and is already in a “long” format. Most analysis (e.g. plotting, regression) works best on long data, but we often present tables in wide format because a long table is hard for a human to interpret.</p>
<p>Long data has one “observation” on each row. This is often the most intuitive way to record data. Consider the hotel booking data…how else would we present it beside one booking per row?!</p>
<table>
<thead>
<tr class="header">
<th align="left">hotel</th>
<th align="left">arrival_date</th>
<th align="right">adr</th>
<th align="left">market_segment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Resort Hotel</td>
<td align="left">2015-07-01</td>
<td align="right">98.0</td>
<td align="left">Online TA</td>
</tr>
<tr class="even">
<td align="left">Resort Hotel</td>
<td align="left">2015-07-01</td>
<td align="right">98.0</td>
<td align="left">Online TA</td>
</tr>
<tr class="odd">
<td align="left">Resort Hotel</td>
<td align="left">2015-07-01</td>
<td align="right">107.0</td>
<td align="left">Direct</td>
</tr>
<tr class="even">
<td align="left">Resort Hotel</td>
<td align="left">2015-07-01</td>
<td align="right">103.0</td>
<td align="left">Direct</td>
</tr>
<tr class="odd">
<td align="left">Resort Hotel</td>
<td align="left">2015-07-01</td>
<td align="right">82.0</td>
<td align="left">Online TA</td>
</tr>
<tr class="even">
<td align="left">Resort Hotel</td>
<td align="left">2015-07-01</td>
<td align="right">105.5</td>
<td align="left">Offline TA/TO</td>
</tr>
</tbody>
</table>
<p>But sometimes we consolidate data. Or you might receive data that is aggregated in some way for you already. Let’s say we were looking at the total bookings per month by hotel…the hotels might be the rows and the months might be the columns.</p>
<table>
<thead>
<tr class="header">
<th align="left">hotel</th>
<th align="right">August</th>
<th align="right">September</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">City Hotel</td>
<td align="right">5381</td>
<td align="right">4290</td>
</tr>
<tr class="even">
<td align="left">Resort Hotel</td>
<td align="right">3257</td>
<td align="right">2102</td>
</tr>
</tbody>
</table>
<p>This data is in <em>wide</em> format and while it’s easy to read, it’s not ideal for plotting or regression. Notice that each row is no longer one “observation” (where an observation is the number of stays at a given hotel in a month). Each row has three observations…the number of stays in each hotel for July, for August, and for September.</p>
<table>
<thead>
<tr class="header">
<th align="left">arrival_date_month</th>
<th align="right">City Hotel</th>
<th align="right">Resort Hotel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Aug</td>
<td align="right">5381</td>
<td align="right">3257</td>
</tr>
<tr class="even">
<td align="left">Sep</td>
<td align="right">4290</td>
<td align="right">2102</td>
</tr>
</tbody>
</table>
<p>How about now? No, still wide format, just in a different way.</p>
<table>
<thead>
<tr class="header">
<th align="left">hotel</th>
<th align="left">arrival_date_month</th>
<th align="right">Total_bookings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">City Hotel</td>
<td align="left">August</td>
<td align="right">5381</td>
</tr>
<tr class="even">
<td align="left">City Hotel</td>
<td align="left">September</td>
<td align="right">4290</td>
</tr>
<tr class="odd">
<td align="left">Resort Hotel</td>
<td align="left">August</td>
<td align="right">3257</td>
</tr>
<tr class="even">
<td align="left">Resort Hotel</td>
<td align="left">September</td>
<td align="right">2102</td>
</tr>
</tbody>
</table>
<p>Here we go…long data ready for analysis. Harder for a human to interpret, though!</p>
</div>
</div>
<div id="the-pipe-operator" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> The Pipe Operator</h2>
<p>The “pipe operator” <code>%&gt;%</code> is one of the handiest function in R. It takes whatever comes on the left and “passes it” as the first argument to the function on the right. Why might that be helpful? Let’s look at an example of what happens when we <em>don’t</em> use the pipe.</p>
<p>Let’s say we want to find the mean daily rate <code>adr</code> (and the min and the max) for guests at the City Hotel from Great Britain (GBR), Ireland (IRL), the US (USA), or Spain (ESP).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="r-and-the-tidyverse.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Mean ADR by country for ONLY City Hotel</span></span>
<span id="cb10-2"><a href="r-and-the-tidyverse.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Without pipe operator</span></span>
<span id="cb10-3"><a href="r-and-the-tidyverse.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="fu">group_by</span>(<span class="fu">filter</span>(booking_data, hotel <span class="sc">==</span> <span class="st">&quot;City Hotel&quot;</span>, country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;GBR&quot;</span>, <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;IRL&quot;</span>, <span class="st">&quot;ESP&quot;</span>)), country), <span class="at">Mean_ADR =</span> <span class="fu">mean</span>(adr))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   country Mean_ADR
## * &lt;chr&gt;      &lt;dbl&gt;
## 1 ESP         114.
## 2 GBR         115.
## 3 IRL         116.
## 4 USA         120.</code></pre>
<p>This works but…wow is it confusing. We have to summarise something that we grouped, that was filtered, that started as the <code>booking_data</code>. One thing is nested inside another.</p>
<p>Try it with the pipe. We take the booking_data, filter it, then group it, and finally summarize it. With the pipe, the code matches our thought process and it’s much easier to debug.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="r-and-the-tidyverse.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With pipe operator</span></span>
<span id="cb12-2"><a href="r-and-the-tidyverse.html#cb12-2" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="r-and-the-tidyverse.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hotel <span class="sc">==</span> <span class="st">&quot;City Hotel&quot;</span>, country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;GBR&quot;</span>, <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;IRL&quot;</span>, <span class="st">&quot;ESP&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="r-and-the-tidyverse.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="r-and-the-tidyverse.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean_ADR =</span> <span class="fu">mean</span>(adr))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   country Mean_ADR
## * &lt;chr&gt;      &lt;dbl&gt;
## 1 ESP         114.
## 2 GBR         115.
## 3 IRL         116.
## 4 USA         120.</code></pre>
</div>
<div id="logicals-and-filtering-the-data" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Logicals and Filtering the Data</h2>
<div id="equal-greater-less-than" class="section level3" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Equal, Greater, Less Than</h3>
<p>Logical tests are very useful in data analysis. We might only want to display hotel bookings with an <code>adr</code> greater than $60, or after the year 2016, etc.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="r-and-the-tidyverse.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Test for equality (whether two things are the same) with double equal sign</span></span>
<span id="cb14-2"><a href="r-and-the-tidyverse.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Does 2 equal 2? Should be true</span></span>
<span id="cb14-3"><a href="r-and-the-tidyverse.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">==</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="r-and-the-tidyverse.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is &quot;New Zealand&quot; the same as &quot;New Zealand&quot;? Should be true</span></span>
<span id="cb16-2"><a href="r-and-the-tidyverse.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;New Zealand&quot;</span> <span class="sc">==</span> <span class="st">&quot;New Zealand&quot;</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="r-and-the-tidyverse.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Similarly, use greater, less than, greater than or equal to etc...</span></span>
<span id="cb18-2"><a href="r-and-the-tidyverse.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Is 3 greater than 4 (FALSE)</span></span>
<span id="cb18-3"><a href="r-and-the-tidyverse.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">&gt;</span> <span class="dv">4</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="r-and-the-tidyverse.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is 7 less than 6 (FALSE)</span></span>
<span id="cb20-2"><a href="r-and-the-tidyverse.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span> <span class="sc">&lt;</span> <span class="dv">6</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="r-and-the-tidyverse.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply less than or equal to operator to a vector of values</span></span>
<span id="cb22-2"><a href="r-and-the-tidyverse.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll get a vector of answers; TRUE for 1 through 3, FALSE otherwise</span></span>
<span id="cb22-3"><a href="r-and-the-tidyverse.html#cb22-3" aria-hidden="true" tabindex="-1"></a>test_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb22-4"><a href="r-and-the-tidyverse.html#cb22-4" aria-hidden="true" tabindex="-1"></a>test_values <span class="sc">&lt;=</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="r-and-the-tidyverse.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># between(x, a, b) is the same as &quot;a &lt;= x &lt;= b&quot;</span></span>
<span id="cb24-2"><a href="r-and-the-tidyverse.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The pipe makes it a little easier to read</span></span>
<span id="cb24-3"><a href="r-and-the-tidyverse.html#cb24-3" aria-hidden="true" tabindex="-1"></a>test_values <span class="sc">%&gt;%</span> <span class="fu">between</span>(<span class="dv">2</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
</div>
<div id="filter-dataset" class="section level3" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Filter dataset</h3>
<p>A common application of these logical tests is to decide which rows (observations) to include in an analysis or a visualization.</p>
<p>The <code>filter</code> command from the <code>dplyr</code> package (part of the <code>tidyverse</code>) is very handy for this. It will filter based on the values of one or more variables. Here are some examples of how to apply it.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="r-and-the-tidyverse.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">### First, lets count the number of rows in the booking_data set</span></span>
<span id="cb26-2"><a href="r-and-the-tidyverse.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The nrow function does this for us</span></span>
<span id="cb26-3"><a href="r-and-the-tidyverse.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(booking_data)</span></code></pre></div>
<pre><code>## [1] 119390</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="r-and-the-tidyverse.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># And how many came from each hotel?</span></span>
<span id="cb28-2"><a href="r-and-the-tidyverse.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(booking_data<span class="sc">$</span>hotel)</span></code></pre></div>
<pre><code>## 
##   City Hotel Resort Hotel 
##        79330        40060</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="r-and-the-tidyverse.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the booking_data to only include bookings at the City Hotel</span></span>
<span id="cb30-2"><a href="r-and-the-tidyverse.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many rows are in the result.</span></span>
<span id="cb30-3"><a href="r-and-the-tidyverse.html#cb30-3" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="r-and-the-tidyverse.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hotel <span class="sc">==</span> <span class="st">&quot;City Hotel&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="r-and-the-tidyverse.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 79330</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="r-and-the-tidyverse.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, we could exclude the Resort Hotel with the &quot;not equal&quot; operator &quot;!=&quot;</span></span>
<span id="cb32-2"><a href="r-and-the-tidyverse.html#cb32-2" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="r-and-the-tidyverse.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hotel <span class="sc">!=</span> <span class="st">&quot;Resort Hotel&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="r-and-the-tidyverse.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 79330</code></pre>
<p>Normally, we will put something “after” the <code>filter</code> command, like passing the result on to <code>ggplot</code> to plot it. If we don’t, we’ll just get the filtered dataframe or vector. Let’s see that.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="r-and-the-tidyverse.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Display a table after filtering it</span></span>
<span id="cb34-2"><a href="r-and-the-tidyverse.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create a tibble (an &quot;enhanced&quot; dataframe)</span></span>
<span id="cb34-3"><a href="r-and-the-tidyverse.html#cb34-3" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb34-4"><a href="r-and-the-tidyverse.html#cb34-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">2</span>))</span>
<span id="cb34-5"><a href="r-and-the-tidyverse.html#cb34-5" aria-hidden="true" tabindex="-1"></a>test <span class="co"># Display the dataframe               </span></span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##      id value
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     3
## 2     2     5
## 3     3     7
## 4     4     3
## 5     5     8
## 6     6     2</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="r-and-the-tidyverse.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, filter it</span></span>
<span id="cb36-2"><a href="r-and-the-tidyverse.html#cb36-2" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="r-and-the-tidyverse.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      id value
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     2     5
## 2     3     7
## 3     5     8</code></pre>
<div id="filter-on-multiple-conditions" class="section level4" number="5.5.2.1">
<h4><span class="header-section-number">5.5.2.1</span> Filter on multiple conditions</h4>
<p>Oftentimes, we want to filter on multiple conditions. Let’s look at the hotel booking data, showing bookings <em>by hotel, by year</em>. In this example, an observation must meet two criteria: be from 2015 <u>and</u> be from the City Hotel. We use the logical operator <code>&amp;</code> to join the two comparisons we make using the double equals <code>==</code>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="r-and-the-tidyverse.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Filter bookings by hotel by year</span></span>
<span id="cb38-2"><a href="r-and-the-tidyverse.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Show table with bookings by hotel by year</span></span>
<span id="cb38-3"><a href="r-and-the-tidyverse.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(booking_data<span class="sc">$</span>arrival_date_year, booking_data<span class="sc">$</span>hotel)</span></code></pre></div>
<pre><code>##       
##        City Hotel Resort Hotel
##   2015      13682         8314
##   2016      38140        18567
##   2017      27508        13179</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="r-and-the-tidyverse.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data to only include bookings from the City Hotel in 2015</span></span>
<span id="cb40-2"><a href="r-and-the-tidyverse.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the number of rows (ie, number of bookings)</span></span>
<span id="cb40-3"><a href="r-and-the-tidyverse.html#cb40-3" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="r-and-the-tidyverse.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(arrival_date_year <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">&amp;</span> hotel <span class="sc">==</span> <span class="st">&quot;City Hotel&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="r-and-the-tidyverse.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 13682</code></pre>
<p>Othertimes, we want to include values that meet at least one of two criteria with the logical <u>or</u> operator, <code>|</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="r-and-the-tidyverse.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Filter the data to  include bookings from the City Hotel OR from the year 2015</span></span>
<span id="cb42-2"><a href="r-and-the-tidyverse.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the number of rows (ie, number of bookings)</span></span>
<span id="cb42-3"><a href="r-and-the-tidyverse.html#cb42-3" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="r-and-the-tidyverse.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(arrival_date_year <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">|</span> hotel <span class="sc">==</span> <span class="st">&quot;City Hotel&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="r-and-the-tidyverse.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 87644</code></pre>
<p>You can combine <code>&amp;</code> and <code>|</code> operators, but note that there is an order of operations just like in math. ANDs will be evaluated (and combined) before the ORs.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="r-and-the-tidyverse.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Filter a data set based on many conditions</span></span>
<span id="cb44-2"><a href="r-and-the-tidyverse.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create a tibble (an &quot;enhanced&quot; dataframe) called test</span></span>
<span id="cb44-3"><a href="r-and-the-tidyverse.html#cb44-3" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="st">&quot;Joe&quot;</span>, <span class="st">&quot;Andres&quot;</span>, <span class="st">&quot;Xuan&quot;</span>, <span class="st">&quot;Aditya&quot;</span>, <span class="st">&quot;Johannes&quot;</span>, <span class="st">&quot;Pinar&quot;</span>),</span>
<span id="cb44-4"><a href="r-and-the-tidyverse.html#cb44-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">2</span>))</span>
<span id="cb44-5"><a href="r-and-the-tidyverse.html#cb44-5" aria-hidden="true" tabindex="-1"></a>test <span class="co"># Display the dataframe </span></span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   id       value
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Joe          3
## 2 Andres       5
## 3 Xuan         7
## 4 Aditya       3
## 5 Johannes     8
## 6 Pinar        2</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="r-and-the-tidyverse.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter test to include specific names</span></span>
<span id="cb46-2"><a href="r-and-the-tidyverse.html#cb46-2" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="r-and-the-tidyverse.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">==</span> <span class="st">&quot;Andres&quot;</span> <span class="sc">|</span> id <span class="sc">==</span> <span class="st">&quot;Xuan&quot;</span> <span class="sc">|</span> id <span class="sc">==</span> <span class="st">&quot;Johannes&quot;</span> <span class="sc">|</span> id <span class="sc">==</span> <span class="st">&quot;Pinar&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   id       value
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Andres       5
## 2 Xuan         7
## 3 Johannes     8
## 4 Pinar        2</code></pre>
<p>This works, but it gets repetitive. Suppose we had a list of 35 countries that we wanted to include. Repeating the <code>id == ... |</code> command is hard to read. The <code>%in%</code> command lets us just ask if a value is in a vector.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="r-and-the-tidyverse.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Filter the test dataframe to include observations for five people</span></span>
<span id="cb48-2"><a href="r-and-the-tidyverse.html#cb48-2" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="r-and-the-tidyverse.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Andres&quot;</span>, <span class="st">&quot;Xuan&quot;</span>, <span class="st">&quot;Aditya&quot;</span>, <span class="st">&quot;Johannes&quot;</span>, <span class="st">&quot;Pinar&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   id       value
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Andres       5
## 2 Xuan         7
## 3 Aditya       3
## 4 Johannes     8
## 5 Pinar        2</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="r-and-the-tidyverse.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can also create the vector outside of the command (or pull it from somewhere else) and just pass the named vector to the filter</span></span>
<span id="cb50-2"><a href="r-and-the-tidyverse.html#cb50-2" aria-hidden="true" tabindex="-1"></a>names_to_include <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Andres&quot;</span>, <span class="st">&quot;Xuan&quot;</span>, <span class="st">&quot;Aditya&quot;</span>, <span class="st">&quot;Johannes&quot;</span>, <span class="st">&quot;Pinar&quot;</span>)</span>
<span id="cb50-3"><a href="r-and-the-tidyverse.html#cb50-3" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="r-and-the-tidyverse.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> names_to_include)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   id       value
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Andres       5
## 2 Xuan         7
## 3 Aditya       3
## 4 Johannes     8
## 5 Pinar        2</code></pre>
<p>You might also want to filter based on patterns in words. The <code>stringr</code> package is excellent for manipulating strings. “<a href="https://en.wikipedia.org/wiki/Regular_expression">Regular expressions</a>” are a very common syntax for manipulating and searching strings that are used across many languages, including R, and can help too.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="r-and-the-tidyverse.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Filter the test dataframe to include names that contain the letter n</span></span>
<span id="cb52-2"><a href="r-and-the-tidyverse.html#cb52-2" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="r-and-the-tidyverse.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(id, <span class="st">&quot;n&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   id       value
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Andres       5
## 2 Xuan         7
## 3 Johannes     8
## 4 Pinar        2</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="r-and-the-tidyverse.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the test dataframe to include names that contain the pattern &quot;Jo&quot;</span></span>
<span id="cb54-2"><a href="r-and-the-tidyverse.html#cb54-2" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="r-and-the-tidyverse.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(id, <span class="st">&quot;Jo&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   id       value
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Joe          3
## 2 Johannes     8</code></pre>
</div>
</div>
</div>
<div id="creating-new-variables" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Creating New Variables</h2>
<p>We often need to create new variables to assist in our data analysis. (In Tableau, these would be called “Calculated Fields”). In our hotel dataset, we have a variable with the number of weekdays (<code>stays_in_weeknights</code>) and the the number of weekend days (<code>stays_in_weekend_nights</code>) but not a variable for the total length of stay (which is just the sum of the weekdays and weekend days).</p>
<p>We can create new variables with the <code>mutate</code> command. Let’s create a new variable, <code>total_stay_length</code>. One neat feature about the mutate command is that you can immediately use the new variable on the next line, so let’s multiply our <code>total_stay_length</code> variable by the average daily rate (<code>adr</code>) to get <code>total_revenue</code> (there’s a problem with this but we’ll talk about it in a minute). Separate each new variable with a comma; putting them on separate lines helps make it easy to read.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="r-and-the-tidyverse.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Create total stay length and revenue variables with mutate command</span></span>
<span id="cb56-2"><a href="r-and-the-tidyverse.html#cb56-2" aria-hidden="true" tabindex="-1"></a>booking_data <span class="ot">&lt;-</span> booking_data <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="r-and-the-tidyverse.html#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_stay_length =</span> stays_in_weekend_nights <span class="sc">+</span> stays_in_week_nights,</span>
<span id="cb56-4"><a href="r-and-the-tidyverse.html#cb56-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_revenue =</span> total_stay_length <span class="sc">*</span> adr)</span></code></pre></div>
<div id="making-dates" class="section level3" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> Making Dates</h3>
<p>Dates are a very common data type, and R has a specific data category so that it knows a particular variable is a date. The <code>lubridate</code> package is excellent for dealing with dates but is NOT included in the <code>tidyverse</code> so you have to load it separately.</p>
<p>Strangely, the dataset we have has <code>arrival_date_year</code> as a numeric variable, <code>arrival_date_month</code> as a character string, and <code>arrival_date_day_of_month</code> as a numeric variable.</p>
<p><em>Note: I didn’t make the data this way! It came this way…an excellent example of the “weird” data you’re sure to encounter in the real world.</em></p>
<p>We need to make a new variable with a proper date for things like graphing, comparing dates, etc, by combining the three fields we do have.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="r-and-the-tidyverse.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Make a consolidated arrival_date field</span></span>
<span id="cb57-2"><a href="r-and-the-tidyverse.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First, &quot;paste&quot; together the day, month, and year into a single string</span></span>
<span id="cb57-3"><a href="r-and-the-tidyverse.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, use the dmy() or &quot;daymonthyear&quot; function from lubridate to turn it into a date</span></span>
<span id="cb57-4"><a href="r-and-the-tidyverse.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># There are similar ymd and mdy functions.</span></span>
<span id="cb57-5"><a href="r-and-the-tidyverse.html#cb57-5" aria-hidden="true" tabindex="-1"></a>booking_data <span class="ot">&lt;-</span> booking_data <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="r-and-the-tidyverse.html#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">arrival_date =</span> <span class="fu">paste0</span>(arrival_date_day_of_month, </span>
<span id="cb57-7"><a href="r-and-the-tidyverse.html#cb57-7" aria-hidden="true" tabindex="-1"></a>                                   arrival_date_month, </span>
<span id="cb57-8"><a href="r-and-the-tidyverse.html#cb57-8" aria-hidden="true" tabindex="-1"></a>                                   arrival_date_year) <span class="sc">%&gt;%</span> <span class="fu">dmy</span>())</span>
<span id="cb57-9"><a href="r-and-the-tidyverse.html#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="r-and-the-tidyverse.html#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display ten records, showing a few key fields including the new arrival_date</span></span>
<span id="cb57-11"><a href="r-and-the-tidyverse.html#cb57-11" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb57-12"><a href="r-and-the-tidyverse.html#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hotel, arrival_date, arrival_date_day_of_month, arrival_date_month, arrival_date_year) <span class="sc">%&gt;%</span></span>
<span id="cb57-13"><a href="r-and-the-tidyverse.html#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span>   <span class="co"># Choose a sample of 10 random rows</span></span>
<span id="cb57-14"><a href="r-and-the-tidyverse.html#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(arrival_date) <span class="sc">%&gt;%</span>  <span class="co"># order by arrival date</span></span>
<span id="cb57-15"><a href="r-and-the-tidyverse.html#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()   <span class="co"># kable makes nice tables</span></span></code></pre></div>
<table>
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="29%" />
<col width="21%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">hotel</th>
<th align="left">arrival_date</th>
<th align="right">arrival_date_day_of_month</th>
<th align="left">arrival_date_month</th>
<th align="right">arrival_date_year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">City Hotel</td>
<td align="left">2015-09-30</td>
<td align="right">30</td>
<td align="left">September</td>
<td align="right">2015</td>
</tr>
<tr class="even">
<td align="left">City Hotel</td>
<td align="left">2015-12-30</td>
<td align="right">30</td>
<td align="left">December</td>
<td align="right">2015</td>
</tr>
<tr class="odd">
<td align="left">Resort Hotel</td>
<td align="left">2016-02-18</td>
<td align="right">18</td>
<td align="left">February</td>
<td align="right">2016</td>
</tr>
<tr class="even">
<td align="left">City Hotel</td>
<td align="left">2016-05-12</td>
<td align="right">12</td>
<td align="left">May</td>
<td align="right">2016</td>
</tr>
<tr class="odd">
<td align="left">City Hotel</td>
<td align="left">2016-07-29</td>
<td align="right">29</td>
<td align="left">July</td>
<td align="right">2016</td>
</tr>
<tr class="even">
<td align="left">Resort Hotel</td>
<td align="left">2016-10-12</td>
<td align="right">12</td>
<td align="left">October</td>
<td align="right">2016</td>
</tr>
<tr class="odd">
<td align="left">City Hotel</td>
<td align="left">2017-01-13</td>
<td align="right">13</td>
<td align="left">January</td>
<td align="right">2017</td>
</tr>
<tr class="even">
<td align="left">Resort Hotel</td>
<td align="left">2017-02-07</td>
<td align="right">7</td>
<td align="left">February</td>
<td align="right">2017</td>
</tr>
<tr class="odd">
<td align="left">City Hotel</td>
<td align="left">2017-05-14</td>
<td align="right">14</td>
<td align="left">May</td>
<td align="right">2017</td>
</tr>
<tr class="even">
<td align="left">City Hotel</td>
<td align="left">2017-07-01</td>
<td align="right">1</td>
<td align="left">July</td>
<td align="right">2017</td>
</tr>
</tbody>
</table>
</div>
<div id="if_else" class="section level3" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> if_else</h3>
<p>What if we want a new variable to take on different values based on another variable? <code>if_else</code> is one way.</p>
<p><code>if_else</code> takes three arguments, in order:</p>
<ul>
<li><p>a logical test or conditions like <code>lead_time &lt;= 14</code></p></li>
<li><p>what to return if this test is TRUE; in this case, the string <code>"Last minute"</code></p></li>
<li><p>what to return if the test is FALSE; <code>"Preplanned"</code></p></li>
<li><p>Optionally, what to replace any missing values with</p></li>
</ul>
<p><em>Note: ifelse (without the underscore) is a base R function whereas if_else is a dplyr function. if_else is faster and more robust.</em></p>
<p>Some people plan trips far in advance. Other trips are more last minute. We know how far in advance the trips were booked (<code>lead_time</code>) in days. Let’s make a new variable called <code>planning</code> that takes the value “Last minute” if the trip was booked 14 days or less prior to the trip, and “Preplanned” if the trip was booked further out.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="r-and-the-tidyverse.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Make a new variable called planning</span></span>
<span id="cb58-2"><a href="r-and-the-tidyverse.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate whether the trip was booked 14 days or less prior to the trip</span></span>
<span id="cb58-3"><a href="r-and-the-tidyverse.html#cb58-3" aria-hidden="true" tabindex="-1"></a>booking_data <span class="ot">&lt;-</span> booking_data <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="r-and-the-tidyverse.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">planning =</span> <span class="fu">if_else</span>(lead_time <span class="sc">&lt;=</span> <span class="dv">14</span>, <span class="st">&quot;Last minute&quot;</span>, <span class="st">&quot;Preplanned&quot;</span>))</span></code></pre></div>
</div>
<div id="case_when" class="section level3" number="5.6.3">
<h3><span class="header-section-number">5.6.3</span> case_when</h3>
<p>if_else is great but sometimes there are more than two options or conditions; it’s not a simple yes/no.</p>
<p>Let’s look at the problem with the <code>total_revenue</code> variable we made earlier. We didn’t actually get all that revenue. Why not? Well, remember that a <em>booking</em> is not the same thing as a completed hotel stay. Some of the bookings were canceled. But we got deposits for some bookings, but not all of them…it’s complicated. Our revenue in each of the following cases is:</p>
<ul>
<li><p>Booking not canceled (<code>is_canceled == 0</code>): Revenue is <code>adr * total_stay_length</code></p></li>
<li><p>If booking is canceled (<code>is_canceled == 1</code>):</p>
<ul>
<li><p>Revenue is <code>adr * total_stay_length</code> <u>only</u> if the deposit was non-refundable (<code>deposit_type == "Non Refund"</code>)</p></li>
<li><p>0 otherwise (<code>deposit_type == "No Deposit"</code> or <code>deposit_type == "Refundable"</code>)</p></li>
</ul></li>
</ul>
<p>You could use a bunch of nested <code>if_else</code> statements, but a <code>case_when</code> is often much cleaner. Let’s make the <code>total_revenue</code> variable the right way now.</p>
<p>Inside <code>case_when</code>, on each line you put a logical test followed by a tilde (<code>~</code>), if the test resolves to <code>TRUE</code>, case_when returns whatever is to the right of the <code>~</code>. Then put a comma, and the next line/condition to test. They will be tested in order; the first one to be true will be the value returned and the function will stop!</p>
<p>On the last line, put <code>TRUE</code> instead of a logical test (to make sure <code>case_when</code> returns something) and the value for whatever the “otherwise” case should be.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="r-and-the-tidyverse.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Create the total_revenue variable the right way based on the cases above</span></span>
<span id="cb59-2"><a href="r-and-the-tidyverse.html#cb59-2" aria-hidden="true" tabindex="-1"></a>booking_data <span class="ot">&lt;-</span> booking_data <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="r-and-the-tidyverse.html#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_revenue =</span> <span class="fu">case_when</span>(is_canceled <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> total_stay_length <span class="sc">*</span> adr,</span>
<span id="cb59-4"><a href="r-and-the-tidyverse.html#cb59-4" aria-hidden="true" tabindex="-1"></a>                                   deposit_type <span class="sc">==</span> <span class="st">&quot;Non Refund&quot;</span> <span class="sc">~</span> total_stay_length <span class="sc">*</span> adr,</span>
<span id="cb59-5"><a href="r-and-the-tidyverse.html#cb59-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)</span>
<span id="cb59-6"><a href="r-and-the-tidyverse.html#cb59-6" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>Why don’t I have to put <code>is_canceled == 1 &amp; deposit_type == "Non Refund"</code> on the second line? I could have and it would work the same way; it wouldn’t be a bad idea to put it there even. But because I already checked if there were any NAs, and I also checked that there are only 0s and 1s in <code>is_canceled</code>, I know that only observations with <code>is_canceled == 1</code> are making it past the first condition of the <code>case_when</code>.</p>
</div>
</div>
<div id="grouping-and-summarizing" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> Grouping and Summarizing</h2>
<div id="grouping" class="section level3" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> Grouping</h3>
<p>We often want to look at things within, between or among groups or subsets of our data. For example, let’s look at the median <code>adr</code> in the hotel bookings. (It’s a bit confusing, the adr is already an average…it’s the average of the daily rate or price over a guest’s booking).</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="r-and-the-tidyverse.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Find the median adr</span></span>
<span id="cb60-2"><a href="r-and-the-tidyverse.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the base r median function</span></span>
<span id="cb60-3"><a href="r-and-the-tidyverse.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(booking_data<span class="sc">$</span>adr)</span></code></pre></div>
<pre><code>## [1] 94.575</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="r-and-the-tidyverse.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Similarly, we could use the dplyr summarize function</span></span>
<span id="cb62-2"><a href="r-and-the-tidyverse.html#cb62-2" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="r-and-the-tidyverse.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_adr =</span> <span class="fu">median</span>(adr))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   median_adr
##        &lt;dbl&gt;
## 1       94.6</code></pre>
<p>This is interesting, but we can go further. We might want to know if the median is different between the two hotels. So we need to group the data by hotel, and then find the median of each group. We do this with the <code>group_by</code> command. We can have multiple levels within a <code>group_by</code>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="r-and-the-tidyverse.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Find median adr by hotel</span></span>
<span id="cb64-2"><a href="r-and-the-tidyverse.html#cb64-2" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="r-and-the-tidyverse.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hotel) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="r-and-the-tidyverse.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_adr =</span> <span class="fu">median</span>(adr)) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="r-and-the-tidyverse.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="co"># Technically, you should probably include this ungroup AFTER you&#39;re done doing whatever needed to be grouped. Practically...I&#39;m lazy. It *can* cause problems sometimes if you don&#39;t.</span></span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   hotel        median_adr
## * &lt;chr&gt;             &lt;dbl&gt;
## 1 City Hotel         99.9
## 2 Resort Hotel       75</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="r-and-the-tidyverse.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find median adr by hotel by cancellation status</span></span>
<span id="cb66-2"><a href="r-and-the-tidyverse.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This will give us a LONG dataframe, because it&#39;s giving us tidy data to take on to the next step (eg, plotting in ggplot)</span></span>
<span id="cb66-3"><a href="r-and-the-tidyverse.html#cb66-3" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="r-and-the-tidyverse.html#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hotel, is_canceled) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="r-and-the-tidyverse.html#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_adr =</span> <span class="fu">median</span>(adr)) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="r-and-the-tidyverse.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   hotel        is_canceled median_adr
##   &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt;
## 1 City Hotel             0       99.9
## 2 City Hotel             1       99.8
## 3 Resort Hotel           0       72  
## 4 Resort Hotel           1       84</code></pre>
<p><em>Note: The order in your group_by doesn’t usually matter too much, because you’ll get a unique combination of each variable in any case. The column order will change, but ggplot (for example) doesn’t care.</em></p>
</div>
<div id="summarize-outside-ggplot" class="section level3" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> Summarize Outside ggplot</h3>
<p>We often want to plot summarized data. Take the example we just discussed, looking at the median adr by hotel. Each observation (booking) is associated with an adr, but we need to group them and present just two quantities.</p>
<p>I prefer to do it the way we just showed, using <code>group_by</code> and <code>summarize</code>, and then passing the dataframe that we saw previously to <code>ggplot</code> for plotting.</p>
<p>Let’s make a scatterplot of this.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="r-and-the-tidyverse.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Make a barchart to compare the median adr by hotel and cancellation status.</span></span>
<span id="cb68-2"><a href="r-and-the-tidyverse.html#cb68-2" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="r-and-the-tidyverse.html#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hotel) <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="r-and-the-tidyverse.html#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_adr =</span> <span class="fu">median</span>(adr)) <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="r-and-the-tidyverse.html#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb68-6"><a href="r-and-the-tidyverse.html#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hotel, <span class="at">y =</span> median_adr)) <span class="sc">+</span></span>
<span id="cb68-7"><a href="r-and-the-tidyverse.html#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;#00759a&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-8"><a href="r-and-the-tidyverse.html#cb68-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Everything below this just cleans up the appearance</span></span>
<span id="cb68-9"><a href="r-and-the-tidyverse.html#cb68-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span><span class="fu">dollar_format</span>())<span class="sc">+</span></span>
<span id="cb68-10"><a href="r-and-the-tidyverse.html#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Hotel&quot;</span>,</span>
<span id="cb68-11"><a href="r-and-the-tidyverse.html#cb68-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Median ADR ($)&quot;</span>,</span>
<span id="cb68-12"><a href="r-and-the-tidyverse.html#cb68-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;Median ADR($) by Hotel&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-13"><a href="r-and-the-tidyverse.html#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb68-14"><a href="r-and-the-tidyverse.html#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="IDSC4210_Course_Notes_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
<div id="inside-ggplot-with-stat_summary" class="section level3" number="5.7.3">
<h3><span class="header-section-number">5.7.3</span> Inside ggplot with stat_summary</h3>
<p>ggplot can also do the summarizing for you. Let’s recreate the plot above, <em>without</em> the <code>group_by</code> and <code>summarise</code>.</p>
<p><code>stat_summary</code> is particularly useful for adding summary statistics (e.g., the mean or median) to a plot where you haven’t summarized the data outside the ggplot function.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="r-and-the-tidyverse.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Make a barchart to compare the median adr by hotel and cancellation status.</span></span>
<span id="cb69-2"><a href="r-and-the-tidyverse.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># use stat_summary in ggplot</span></span>
<span id="cb69-3"><a href="r-and-the-tidyverse.html#cb69-3" aria-hidden="true" tabindex="-1"></a>booking_data <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="r-and-the-tidyverse.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hotel, <span class="at">y =</span> adr)) <span class="sc">+</span></span>
<span id="cb69-5"><a href="r-and-the-tidyverse.html#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">&quot;median&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#00759a&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-6"><a href="r-and-the-tidyverse.html#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Everything below this just cleans up the appearance</span></span>
<span id="cb69-7"><a href="r-and-the-tidyverse.html#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span><span class="fu">dollar_format</span>())<span class="sc">+</span></span>
<span id="cb69-8"><a href="r-and-the-tidyverse.html#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Hotel&quot;</span>,</span>
<span id="cb69-9"><a href="r-and-the-tidyverse.html#cb69-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Median ADR ($)&quot;</span>,</span>
<span id="cb69-10"><a href="r-and-the-tidyverse.html#cb69-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;Median ADR($) by Hotel&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-11"><a href="r-and-the-tidyverse.html#cb69-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb69-12"><a href="r-and-the-tidyverse.html#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_segment).</code></pre>
<p><img src="IDSC4210_Course_Notes_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
</div>
<div id="joining-data" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> Joining Data</h2>
<p>We often don’t have all of the data we need in one place (if you’ve taken Data Engineering, you understand this well!).</p>
<p>“Joins” allow us to combine data from multiple tables.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="r-and-the-tidyverse.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Combine data from two tables</span></span>
<span id="cb71-2"><a href="r-and-the-tidyverse.html#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="r-and-the-tidyverse.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># First let&#39;s make a list of the top 20 countries with the most bookings</span></span>
<span id="cb71-4"><a href="r-and-the-tidyverse.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use rank function (this can be slow because it has to sort the data)</span></span>
<span id="cb71-5"><a href="r-and-the-tidyverse.html#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorting can be very computationally intensive</span></span>
<span id="cb71-6"><a href="r-and-the-tidyverse.html#cb71-6" aria-hidden="true" tabindex="-1"></a>top_countries <span class="ot">&lt;-</span> booking_data <span class="sc">%&gt;%</span></span>
<span id="cb71-7"><a href="r-and-the-tidyverse.html#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb71-8"><a href="r-and-the-tidyverse.html#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_bookings =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb71-9"><a href="r-and-the-tidyverse.html#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="sc">-</span>num_bookings)) <span class="sc">%&gt;%</span></span>
<span id="cb71-10"><a href="r-and-the-tidyverse.html#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rank <span class="sc">&lt;=</span><span class="dv">20</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb71-11"><a href="r-and-the-tidyverse.html#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rank)</span>
<span id="cb71-12"><a href="r-and-the-tidyverse.html#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="r-and-the-tidyverse.html#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We want the hotel data too, so let&#39;s actually go back and then use this list to filter</span></span>
<span id="cb71-14"><a href="r-and-the-tidyverse.html#cb71-14" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> booking_data <span class="sc">%&gt;%</span></span>
<span id="cb71-15"><a href="r-and-the-tidyverse.html#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hotel, country) <span class="sc">%&gt;%</span></span>
<span id="cb71-16"><a href="r-and-the-tidyverse.html#cb71-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_bookings =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb71-17"><a href="r-and-the-tidyverse.html#cb71-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> top_countries<span class="sc">$</span>country)</span>
<span id="cb71-18"><a href="r-and-the-tidyverse.html#cb71-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-19"><a href="r-and-the-tidyverse.html#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="co"># These are ISO country codes...a worldwide standard.  Let&#39;s take a look.</span></span>
<span id="cb71-20"><a href="r-and-the-tidyverse.html#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.nationsonline.org/oneworld/country_code_list.htm</span></span>
<span id="cb71-21"><a href="r-and-the-tidyverse.html#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="co"># They all have three letters...except for &quot;CN&quot;</span></span>
<span id="cb71-22"><a href="r-and-the-tidyverse.html#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Both &quot;CN&quot; and &quot;CHN&quot; appear in the dataset, but both refer to China. Maybe data was coming from two different systems (using the 2 and 3 letter standards) and wasn&#39;t properly combined.  Let&#39;s combine them and remove the value for &quot;CN&quot;</span></span>
<span id="cb71-23"><a href="r-and-the-tidyverse.html#cb71-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-24"><a href="r-and-the-tidyverse.html#cb71-24" aria-hidden="true" tabindex="-1"></a>countries[countries<span class="sc">$</span>country<span class="sc">==</span><span class="st">&quot;CHN&quot;</span> <span class="sc">&amp;</span> countries<span class="sc">$</span>hotel<span class="sc">==</span><span class="st">&quot;City Hotel&quot;</span>, <span class="st">&quot;num_bookings&quot;</span>] <span class="ot">&lt;-</span> countries[countries<span class="sc">$</span>country<span class="sc">==</span><span class="st">&quot;CHN&quot;</span> <span class="sc">&amp;</span> countries<span class="sc">$</span>hotel<span class="sc">==</span><span class="st">&quot;City Hotel&quot;</span>, <span class="st">&quot;num_bookings&quot;</span>] <span class="sc">+</span> countries[countries<span class="sc">$</span>country<span class="sc">==</span><span class="st">&quot;CN&quot;</span>  <span class="sc">&amp;</span> countries<span class="sc">$</span>hotel<span class="sc">==</span><span class="st">&quot;City Hotel&quot;</span>, <span class="st">&quot;num_bookings&quot;</span>]</span>
<span id="cb71-25"><a href="r-and-the-tidyverse.html#cb71-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-26"><a href="r-and-the-tidyverse.html#cb71-26" aria-hidden="true" tabindex="-1"></a>countries[countries<span class="sc">$</span>country<span class="sc">==</span><span class="st">&quot;CHN&quot;</span> <span class="sc">&amp;</span> countries<span class="sc">$</span>hotel<span class="sc">==</span><span class="st">&quot;Resort Hotel&quot;</span>, <span class="st">&quot;num_bookings&quot;</span>] <span class="ot">&lt;-</span> countries[countries<span class="sc">$</span>country<span class="sc">==</span><span class="st">&quot;CHN&quot;</span> <span class="sc">&amp;</span> countries<span class="sc">$</span>hotel<span class="sc">==</span><span class="st">&quot;Resort Hotel&quot;</span>, <span class="st">&quot;num_bookings&quot;</span>] <span class="sc">+</span> countries[countries<span class="sc">$</span>country<span class="sc">==</span><span class="st">&quot;CN&quot;</span>  <span class="sc">&amp;</span> countries<span class="sc">$</span>hotel<span class="sc">==</span><span class="st">&quot;Resort Hotel&quot;</span>, <span class="st">&quot;num_bookings&quot;</span>]</span>
<span id="cb71-27"><a href="r-and-the-tidyverse.html#cb71-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-28"><a href="r-and-the-tidyverse.html#cb71-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure to delete the &quot;CN&quot; observation! we can use the subset function</span></span>
<span id="cb71-29"><a href="r-and-the-tidyverse.html#cb71-29" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> countries <span class="sc">%&gt;%</span> <span class="fu">subset</span>(country <span class="sc">!=</span><span class="st">&quot;CN&quot;</span>)</span>
<span id="cb71-30"><a href="r-and-the-tidyverse.html#cb71-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-31"><a href="r-and-the-tidyverse.html#cb71-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Okay, let&#39;s pull in some other data, which I have conveniently pulled here.</span></span>
<span id="cb71-32"><a href="r-and-the-tidyverse.html#cb71-32" aria-hidden="true" tabindex="-1"></a>geographic_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">country_code =</span> <span class="fu">c</span>(<span class="st">&quot;PRT&quot;</span>, <span class="st">&quot;GBR&quot;</span>, <span class="st">&quot;FRA&quot;</span>, <span class="st">&quot;ESP&quot;</span>, <span class="st">&quot;DEU&quot;</span>,</span>
<span id="cb71-33"><a href="r-and-the-tidyverse.html#cb71-33" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;ITA&quot;</span>, <span class="st">&quot;IRL&quot;</span>, <span class="st">&quot;BEL&quot;</span>, <span class="st">&quot;BRA&quot;</span>, <span class="st">&quot;NLD&quot;</span>,</span>
<span id="cb71-34"><a href="r-and-the-tidyverse.html#cb71-34" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;CHE&quot;</span>, <span class="st">&quot;AUT&quot;</span>, <span class="st">&quot;SWE&quot;</span>, <span class="st">&quot;CHN&quot;</span>,</span>
<span id="cb71-35"><a href="r-and-the-tidyverse.html#cb71-35" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;POL&quot;</span>, <span class="st">&quot;ISR&quot;</span>, <span class="st">&quot;RUS&quot;</span>, <span class="st">&quot;NOR&quot;</span>),</span>
<span id="cb71-36"><a href="r-and-the-tidyverse.html#cb71-36" aria-hidden="true" tabindex="-1"></a>                          <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Portugal&quot;</span>, <span class="st">&quot;Great Britain&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;Spain&quot;</span>, <span class="st">&quot;Germany&quot;</span>,</span>
<span id="cb71-37"><a href="r-and-the-tidyverse.html#cb71-37" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Italy&quot;</span>, <span class="st">&quot;Ireland&quot;</span>, <span class="st">&quot;Belgium&quot;</span>, <span class="st">&quot;Brazil&quot;</span>, <span class="st">&quot;Netherlands&quot;</span>,</span>
<span id="cb71-38"><a href="r-and-the-tidyverse.html#cb71-38" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;United States&quot;</span>, <span class="st">&quot;Switzerland&quot;</span>, <span class="st">&quot;Austria&quot;</span>, <span class="st">&quot;Sweden&quot;</span>,</span>
<span id="cb71-39"><a href="r-and-the-tidyverse.html#cb71-39" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;China&quot;</span>,<span class="st">&quot;Poland&quot;</span>, <span class="st">&quot;Israel&quot;</span>, <span class="st">&quot;Russia&quot;</span>, <span class="st">&quot;Norway&quot;</span>),</span>
<span id="cb71-40"><a href="r-and-the-tidyverse.html#cb71-40" aria-hidden="true" tabindex="-1"></a>                            <span class="at">distance_km =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1812</span>, <span class="dv">1140</span>, <span class="dv">402</span>, <span class="dv">2397</span>,</span>
<span id="cb71-41"><a href="r-and-the-tidyverse.html#cb71-41" aria-hidden="true" tabindex="-1"></a>                                            <span class="dv">1771</span>, <span class="dv">1558</span>, <span class="dv">1584</span>, <span class="dv">7487</span>, <span class="dv">1756</span>,</span>
<span id="cb71-42"><a href="r-and-the-tidyverse.html#cb71-42" aria-hidden="true" tabindex="-1"></a>                                            <span class="dv">7317</span>, <span class="dv">1565</span>, <span class="dv">2038</span>, <span class="dv">2964</span>, <span class="dv">9158</span>,</span>
<span id="cb71-43"><a href="r-and-the-tidyverse.html#cb71-43" aria-hidden="true" tabindex="-1"></a>                                            <span class="dv">2519</span>, <span class="dv">3982</span>, <span class="dv">7311</span>, <span class="dv">2613</span>),</span>
<span id="cb71-44"><a href="r-and-the-tidyverse.html#cb71-44" aria-hidden="true" tabindex="-1"></a>                          <span class="at">continent =</span> <span class="fu">c</span>(<span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, </span>
<span id="cb71-45"><a href="r-and-the-tidyverse.html#cb71-45" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;South America&quot;</span>,</span>
<span id="cb71-46"><a href="r-and-the-tidyverse.html#cb71-46" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;North America&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>,</span>
<span id="cb71-47"><a href="r-and-the-tidyverse.html#cb71-47" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>,</span>
<span id="cb71-48"><a href="r-and-the-tidyverse.html#cb71-48" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Europe&quot;</span>))</span>
<span id="cb71-49"><a href="r-and-the-tidyverse.html#cb71-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice there&#39;s a judgment call here...how are we measuring distance? To the center of the country? Border?</span></span>
<span id="cb71-50"><a href="r-and-the-tidyverse.html#cb71-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-51"><a href="r-and-the-tidyverse.html#cb71-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s transform this NEW dataset by adding in data on the Schengen Area...where you can travel without a visa</span></span>
<span id="cb71-52"><a href="r-and-the-tidyverse.html#cb71-52" aria-hidden="true" tabindex="-1"></a>geographic_data<span class="sc">$</span>schengen <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb71-53"><a href="r-and-the-tidyverse.html#cb71-53" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb71-54"><a href="r-and-the-tidyverse.html#cb71-54" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>,</span>
<span id="cb71-55"><a href="r-and-the-tidyverse.html#cb71-55" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>, <span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>)</span>
<span id="cb71-56"><a href="r-and-the-tidyverse.html#cb71-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-57"><a href="r-and-the-tidyverse.html#cb71-57" aria-hidden="true" tabindex="-1"></a><span class="co"># We might want to analyze where guests come from.  But we need to JOIN this dataset with our booking data.</span></span>
<span id="cb71-58"><a href="r-and-the-tidyverse.html#cb71-58" aria-hidden="true" tabindex="-1"></a><span class="co"># We will do a left join, to keep everything in our countries dataset.</span></span>
<span id="cb71-59"><a href="r-and-the-tidyverse.html#cb71-59" aria-hidden="true" tabindex="-1"></a><span class="co"># JOIN BY country...but the country code is called &quot;country&quot; in the countries dataset and &quot;country_code&quot; in the other</span></span>
<span id="cb71-60"><a href="r-and-the-tidyverse.html#cb71-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-61"><a href="r-and-the-tidyverse.html#cb71-61" aria-hidden="true" tabindex="-1"></a>country_joined <span class="ot">&lt;-</span> <span class="fu">left_join</span>(countries, geographic_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span> <span class="ot">=</span> <span class="st">&quot;country_code&quot;</span>))</span></code></pre></div>
<p>Let’s look at the <code>country_joined</code> dataframe, which now contains all of the booking data from the original dataframe, alone with the geopolitical information we added.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="r-and-the-tidyverse.html#cb72-1" aria-hidden="true" tabindex="-1"></a>country_joined</span></code></pre></div>
<pre><code>## # A tibble: 38 x 7
## # Groups:   hotel [2]
##    hotel      country num_bookings name        distance_km continent    schengen
##    &lt;chr&gt;      &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;   
##  1 City Hotel AUT             1053 Austria            2038 Europe       Yes     
##  2 City Hotel BEL             1894 Belgium            1584 Europe       Yes     
##  3 City Hotel BRA             1794 Brazil             7487 South Ameri… No      
##  4 City Hotel CHE             1295 Switzerland        1565 Europe       Yes     
##  5 City Hotel CHN             1434 China              9158 Asia         No      
##  6 City Hotel DEU             6084 Germany            2397 Europe       Yes     
##  7 City Hotel ESP             4611 Spain               402 Europe       Yes     
##  8 City Hotel FRA             8804 France             1140 Europe       Yes     
##  9 City Hotel GBR             5315 Great Brit…        1812 Europe       No      
## 10 City Hotel IRL             1209 Ireland            1558 Europe       No      
## # … with 28 more rows</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="design-fundamentals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="intro-to-ggplot.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["IDSC4210_Course_Notes.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>
